<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
<body>
    <br>
    <br>
    <center>
        <h1>Roll Call ✋</h1>
    </center>
    <br>
    <div class="container-fluid">
        <div class="card card-body bg-light">
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <h3><label for="exampleFormControlTextarea1">Registery Names</label></h3>
                        <textarea class="form-control" id="registry" rows="20"></textarea>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <h3><label for="exampleFormControlTextarea1">Search Names</label></h3>
                        <textarea class="form-control" id="search" rows="20"></textarea>
                    </div>
                </div>
                <div class="col-md-6">
                    <h3>Results</h3>
                    <hr>
                    <div id="results">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>

<script>
    let characters = [{
                        "name": "Philip J. Fry",
                        "company": "Planet Express",
                        "species": "human",
                        "thumb": "/images/Philip-J-Fry.png"
                      },
                      {
                        "name": "Turanga Leela",
                        "company": "Planet Express",
                        "species": "mutant",
                        "thumb": "/images/Turanga-Leela.png"
                      },
                      {
                        "name": "Bender Bending Rodriguez",
                        "company": "Planet Express",
                        "species": "robot",
                        "thumb": "/images/Bender_Rodriguez.png"
                      },
                      {
                        "name": "Amy Wong",
                        "company": "Planet Express",
                        "species": "human",
                        "thumb": "/images/AmyWong.png"
                      },
                      {
                        "name": "Hermes Conrad",
                        "company": "Planet Express",
                        "species": "human",
                        "thumb": "/images/Hermes.png"
                      },
                      {
                        "name": "Professor Hubert J. Farnsworth",
                        "company": "Planet Express",
                        "species": "human",
                        "thumb": "/images/Professor-Farnsworth.png"
                      },
                      {
                        "name": "Doctor John Zoidberg",
                        "company": "Planet Express",
                        "species": "decapodian",
                        "thumb": "/images/Dr_John_Zoidberg.png"
                      },
                      {
                        "name": "Zapp Brannigan",
                        "company": "Democratic Order of Planets",
                        "species": "human",
                        "thumb": "/images/Zapp-Brannigan.png"
                      },
                      {
                        "name": "Kif Kroker",
                        "company": "Democratic Order of Planets",
                        "species": "amphibiosans",
                        "thumb": "/images/Kif-Kroker.png"
                      },
                      {
                        "name": "Mom",
                        "company": "MomCorp",
                        "species": "human",
                        "thumb": "/images/Mom.png"
                      },
                      {
                        "name": "Scruffy Scruffington",
                        "company": "Planet Express",
                        "species": "human",
                        "thumb": "/images/Scruffy.png"
                      },
                      {
                        "name": "Morbo",
                        "company": "Channel √2 News",
                        "species": "unknown",
                        "thumb": "/images/Morbo.png"
                      },
                      {
                        "name": "Slurms MacKenzie",
                        "company": "Slurm",
                        "species": "slurm worm",
                        "thumb": "/images/Slurm-1-.jpg"
                      },
                      {
                        "name": "Larry Miller",
                        "company": "MomCorp",
                        "species": "human",
                        "thumb": "/images/Larry.jpg"
                      },
                      {
                        "name": "Igner Miller",
                        "company": "MomCorp",
                        "species": "human",
                        "thumb": "/images/Igner.png"
                      },
                      {
                        "name": "Walter Miller",
                        "company": "MomCorp",
                        "species": "human",
                        "thumb": "/images/WaltMomCorp.png"
                      },
                      {
                        "name": "Linda van Schoonhoven",
                        "company": "Channel √2 News",
                        "species": "human",
                        "thumb": "/images/Linda.jpg"
                      },
                      {
                        "name": "Wormulon Queen",
                        "company": "Slurm",
                        "species": "slurm worm",
                        "thumb": "/images/Wormulon_Queen.jpg"
                      },
                      {
                        "name": "Lrrr",
                        "company": "Omicron Persei 8",
                        "species": "omicronian",
                        "thumb": "/images/Lrrr.png"
                      },
                      {
                        "name": "Ndnd",
                        "company": "Omicron Persei 8",
                        "species": "omicronian",
                        "thumb": "/images/Ndnd.jpg"
                      }
                    ];

    // const fuse = new Fuse(characters, {
    //     keys: [
    //         'name',
    //         'company',
    //         'species'
    //     ],
    //     includeScore: true
    // })

    $(document).ready(function() {
        $('#registry').on('input', convertArray);
        $('#search').on('input', search);
    });

    const fuse = new Fuse([], {
        includeScore: true}
    );

    let registryArray = [];

    function convertArray(e) {
        registryArray = [];
        registryArray = $(e.target).val().split(/\r?\n/);

        fuse.setCollection(registryArray);
    }

    const spinner = "<div><center><div class='spinner-border' role='status'><span class='sr-only'>Loading...</span></div></center></div>";

    function search(e) {
        searchArray = [];
        searchArray = $(e.target).val().split(/\r?\n/);

        $('#results').empty();
        // $('#results').append(spinner);

        searchArray.forEach(e => {
            $resultDiv = $("<div class='card'>");
            $resultDiv.append(`<div class='card-header'>${e}`);
            $resultsUl = $("<ul class='list-group list-group-flush'>");

            fuseSearch = fuse.search(e);
            fuseSearch.forEach(e => {
                score = e.score.toFixed(2);
                if (score <= 0.6) {
                    pill = 'primary';
                    if (score <= 0.2) {
                        pill = 'success';
                    }
                    $resultsUl.append(`
                        <li class="list-group-item">
                            <span class="badge badge-warning">${e.refIndex+1}</span>
                            ${e.item}
                            <span class="badge badge-${pill}">${score}</span></li>`);
                }

                console.log(e);
            })

            $resultDiv.append($resultsUl);

            // $('#results').append(`found... ${fuseSearch[0].item} [${fuseSearch[0].score.toFixed(2)}]`);
            $('#results').append($resultDiv).append('<br>');
        });
        // result = fuse.search('frank');
        // $('#results').text('abc');
    }

    // $('div.lawyerList').on('change','textarea',function(){
    //   // Change occurred so count chars...
    // });


</script>
